# Rétrospective Epic 1 : Inscription, Authentification & Profil Utilisateur

**Date :** 2026-02-13
**Facilitateur :** Bob (Scrum Master)
**Participants :** Vincent (Project Lead), Alice (PM), Charlie (Senior Dev), Dana (QA), Elena (Junior Dev), Sally (UX Designer)

---

## Résumé de l'Epic

| Métrique | Valeur |
|----------|--------|
| Stories planifiées | 4 |
| Stories livrées | 4 (100%) |
| Tests totaux | 62 (16 backend unit, 9 E2E, 37 frontend) |
| Tests skippés | 1 (`refresh.interceptor.spec.ts`) |
| Issues code review | 31 (total sur 4 stories) |
| Incidents production | 0 |
| Agent IA utilisé | Claude Opus 4.6 |

### Stories livrées

- **1.1** — Initialisation du projet et infrastructure de développement
- **1.2** — Inscription utilisateur (13 issues review, 10 fixées)
- **1.3** — Connexion et déconnexion (8 issues review, 6 fixées)
- **1.4** — Gestion du profil utilisateur (5 debug fixes)

---

## Ce qui a bien fonctionné

### Architecture Auth production-grade
Le flow d'authentification livré est solide : JWT hybride (access in-memory, refresh httpOnly cookie), refresh token rotation avec détection de vol de token, timing side-channel prevention via dummy hash Argon2id. C'est du niveau production dès le premier epic.

### Patterns ESM + Prisma 7 stabilisés
Malgré une courbe d'apprentissage douloureuse en Story 1.2, les patterns ESM (`"type": "module"`, extensions `.js`, `tsc-alias` post-build) et Prisma 7 (Driver Adapters, `prisma.config.ts`, composition pattern) ont servi de référence solide pour les Stories 1.3 et 1.4. Le développement est devenu fluide une fois ces patterns établis.

### Couverture de tests dès le début
62 tests passants avec une bonne répartition unit/E2E/frontend. Les code reviews ont poussé la qualité vers le haut à chaque story.

### Pattern Cloudflare R2 réutilisable
Le `FilesModule` introduit en Story 1.4 est propre et extensible pour les futurs uploads de médias (messagerie Epic 4).

### Développement fluide
Retour de Vincent : en dehors des deux problèmes identifiés (CSS et EMFILE), les développements se sont déroulés sans accrocs majeurs.

---

## Ce qui n'a pas fonctionné

### CRITIQUE — Absence totale de styling/design system
Le UX Design Specification existe (système de couleurs, typographie, spacing, thèmes) mais n'a été intégré dans aucune story comme livrable. Les composants créés (register, login, account, profile-editor) utilisent du Tailwind basique sans design tokens. Le header ne contient qu'un bouton déconnexion — pas de navigation, pas d'accès au compte.

**Cause racine :** Gap de planification. Les Dev Notes des stories référençaient le UX Spec mais aucune tâche concrète de styling n'était assignée.

### CRITIQUE — Bug EMFILE : crash backend en dev
Le processus `tsc-alias -w` (watch mode) scanne l'ensemble du projet y compris `node_modules`, causant un crash `EMFILE: too many open files` après ~20 secondes sur Windows. Le backend est inutilisable en mode dev local.

**Cause racine :** `tsc-alias` en mode watch n'a pas de filtrage de `node_modules`. Le bug n'a pas été détecté car les tests (Jest, Vitest) n'utilisent pas le mode watch de `tsc-alias`.

### Volume élevé d'issues en code review
31 issues sur 4 stories, dont 5 HIGH en Story 1.2 seule (intercepteur no-op, rate limiting non testé, timing side-channel, `process.env` direct, magic numbers). La découverte simultanée de 4 technologies nouvelles (ESM, Prisma 7, Zod 4, Angular 21 zoneless) a amplifié les risques.

### Test skippé
`refresh.interceptor.spec.ts` (Story 1.3) a été skippé pour complexité. C'est une dette technique explicite.

---

## Décisions prises

### Décision 1 — Création de l'Epic 1.5 : Consolidation & Design System

**Contexte :** Le cumul de l'absence de CSS et du bug EMFILE justifie un epic dédié de consolidation avant de poursuivre avec l'Epic 2 (Groupes & Invitations).

**Scope validé — 3 stories :**

**Story 1.5.1 — Fix tsc-alias + stabilisation infra dev**
- Éliminer `tsc-alias` du pipeline de dev au profit d'une solution propre (loader natif Node.js ou revoir la stratégie d'import)
- Vérifier que `start:dev`, `build` et tous les scripts fonctionnent sans crash sur Windows et Linux
- Rattraper le test skippé `refresh.interceptor.spec.ts`

**Story 1.5.2 — Design tokens Tailwind + composants de base**
- Implémenter les design tokens depuis le UX Spec : couleurs (palette underground/fun), spacing (4px multiples), typography (Inter, type scale), radius, shadows
- Thème dark par défaut, préparer le switch light/dark
- Composants de base réutilisables : boutons, inputs, cards, toast/notification, modales
- Font Inter importée et configurée

**Story 1.5.3 — Styling pages existantes + navigation header**
- Restyler register, login, account, profile-editor selon le design system
- Implémenter le header/navigation principal avec avatar et accès au compte
- Responsive mobile-first
- Skeleton screens cohérents avec le design system

### Décision 2 — Amélioration du process : styling obligatoire

Dès l'Epic 2, chaque story créant un composant UI doit inclure une tâche de styling explicite référençant le design system. Le code review vérifie l'alignement avec le UX Spec. "Styling conforme au design system" devient un critère d'acceptance implicite pour toute story UI.

### Décision 3 — Amélioration du process : test de l'environnement de dev

Chaque story d'infrastructure doit vérifier que `pnpm start:dev` tourne au moins 2 minutes sans crash avant de marquer la story comme done.

---

## Action Items

| # | Action | Priorité | Owner |
|---|--------|----------|-------|
| A1 | Créer l'Epic 1.5 (3 stories) dans epics.md | Bloquant | Bob (SM) |
| A2 | Mettre à jour sprint-status.yaml (Epic 1 → done, Epic 1.5 inséré) | Immédiat | Bob (SM) |
| A3 | Rédiger les stories détaillées de l'Epic 1.5 | Bloquant | Bob (SM) / Alice (PM) |
| A4 | Intégrer le styling obligatoire dans le process de story creation | Dès Epic 2 | Bob (SM) |
| A5 | Intégrer le smoke test `start:dev` dans le process de validation | Dès Epic 1.5 | Dana (QA) |

---

## Readiness Epic 1.5

| Dimension | Status | Notes |
|-----------|--------|-------|
| UX Spec | Prêt | Système de couleurs, typography, spacing déjà documentés |
| Alternatives tsc-alias | Identifiées | `tsconfig-paths` runtime, loaders natifs Node.js |
| Composants à restyler | Identifiés | register, login, account, profile-editor, header |
| Risques | Faibles | Consolidation pure, pas de nouvelle fonctionnalité |
| Dépendances | Aucune | Auto-contenu, ne bloque pas et n'est pas bloqué par des tiers |

---

## Métriques à surveiller pour l'Epic 1.5

- Nombre d'issues de code review (objectif : < 5 par story)
- Tests skippés (objectif : 0)
- Crash `start:dev` (objectif : 0)
- Couverture du design system (% de composants stylisés selon UX Spec)
